---
tags:
  - golang
  - Программирование
  - Продуктивность
  - Интерфейсы
создал заметку: 2025-08-17
---
### Интерфейсы в Go

1. Что такое интерфейсы в Go? Чем отличается от интерфейсов в других языках, например, Java, PHP. Что такое утиная типизация?
   В **Go интерфейс** — это набор методов (контракт), который должен реализовать тип. Если тип реализует **все методы интерфейса**, он считается удовлетворяющим этому интерфейсу.
   В **Go** реализация **неявная**: если структура содержит все методы, описанные в интерфейсе — она автоматически реализует его.
   
   Это называется **утиная типизация** (duck typing):

> `"Если что-то крякает как утка и плавает как утка — значит, это утка"`
   
2. Внутреннее устройство интерфейса, какое оно (структура iface, itab)?
   В Go интерфейсы под капотом устроены как структуры:
   - **iface** (интерфейс с методами) состоит из:
     - `tab` → указатель на **itab** (таблица методов для данного типа и интерфейса);
     - `data` → указатель на данные (конкретное значение, реализующее интерфейс).
 - **itab** содержит:
   - указатель на тип (`_type`);
   - указатель на интерфейс;
   - таблицу функций для методов интерфейса.
	Таким образом, вызов метода по интерфейсу в Go — это вызов через таблицу методов (**динамическая диспетчеризация**), похожая на виртуальные таблицы (vtable) в C++.
3. Сделать интерфейс для вычисления площади круга и квадрата, реализовать их в структурах cicle и square.
	``` go
	package main
	
	import (
	    "fmt"
	    "math"
	)
	
	type Shape interface {
	    Area() float64
	}
	
	type Circul struct {
	    Radius float64
	}
	
	type Square struct {
	    Side float64
	}
	
	func (s Square) Area() float64 {
	    return s.Side * s.Side
	}

	func (s Circul) Area() float64 {
	    return s.Radius * s.Radius * math.Pi
	}

	func UnknownArea(s Shape) {
	    fmt.Println(s.Area())
	}

	func main() {
	    circ := Circul{5}
	    UnknownArea(circ)

	    Sqrt := Square{5}
	    UnknownArea(Sqrt)
	}
	```
4. Что такое пустой интерфейс?
	```
	var x interface{}
	x = 42
	x = "строка"
	
	```
	Пустой интерфейс **не содержит методов**, значит **любой тип** его реализует.
	Используется как "универсальный контейнер" (аналог `Object` в Java, `any` в TypeScript).
5. Что такое nil интерфейс?
   `nil`-интерфейс — это интерфейсная переменная, у которой **оба указателя nil**: и `tab`, и `data`. 
   Такой интерфейс не ссылается ни на что.
   Важно: интерфейс с `nil`-значением внутри **не равен nil**, потому что `tab` указывает на тип.
6. Что такое type switch?
   Конструкция для определения **конкретного типа** значения внутри интерфейса.
	``` go
	func printType(i interface{}) {
	    switch v := i.(type) {
	    case int:
	        fmt.Println("int:", v)
	    case string:
	        fmt.Println("string:", v)
	    default:
	        fmt.Println("unknown type")
	    }
	}
	```
7. Как определить тип интерфейса?
   Используется **type assertion**:
	``` go
	var i interface{} = "hello"
	s, ok := i.(string) // ok = true
	n, ok := i.(int)    // ok = false
	```
8. Как преобразовать интерфейс к другому типу?
   Через **type assertion** (как выше) или через **type switch**. 
   Если интерфейс один, а нужен другой — делают "обёртку", потому что прямого преобразования интерфейсов в Go нет (только к конкретным типам).
9. Где следует поместить описание интерфейса: в пакете с реализацией или в пакете, где этот интерфейс используется? Почему?
   Рекомендуемое правило Go:
   - Интерфейсы **описываются там, где они используются**, а не в пакете с реализацией.
    Причина:
    - Реализаций может быть много (разные структуры).
    - Интерфейс нужен потребителю, а не производителю.  
    Это делает код более гибким и снижает зависимость между пакетами.
    Пример: в пакете `io` есть интерфейс `Reader`, но его реализуют десятки разных пакетов.
